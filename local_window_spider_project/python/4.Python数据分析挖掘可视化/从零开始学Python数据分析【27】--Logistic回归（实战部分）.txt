b'\xe4\xbb\x8e\xe9\x9b\xb6\xe5\xbc\x80\xe5\xa7\x8b\xe5\xad\xa6Python\xe6\x95\xb0\xe6\x8d\xae\xe5\x88\x86\xe6\x9e\x90\xe3\x80\x9027\xe3\x80\x91--Logistic\xe5\x9b\x9e\xe5\xbd\x92\xef\xbc\x88\xe5\xae\x9e\xe6\x88\x98\xe9\x83\xa8\xe5\x88\x86\xef\xbc\x89'                           





基于上一期的理论知识，我们本期跟大家分享一下<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(0, 82, 255);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">如何通过Python和R语言完成Logistic回归分类器的构建</strong></span>。大家都知道，Logistic模型主要是用来解决二元分类问题，通过构建分类器，计算每一个样本为目标分类的概率，一般而言，我们会将概率值0.5作为分类的阈值，即概率值P大于等于0.5时判别为目标分类，否则为另一种分类。






本次分享的数据是基于用户信息（年龄、性别和年收入）来判断其是否发生购买，数据来源于GitHub（文末有数据链接可供下载）。接下来，让我们看看Logistic模型是如何完成二分类问题的落地。<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(0, 82, 255);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">本次分享会涉及模型的构建、测试集的预测及模型的验证三个方面。</strong></span>
https://mmbiz.qpic.cn/mmbiz_png/yjFUicxiaClgX68KMUXlCrcDZBLibB39ONUu9YfhB85LQz95zw798iaic8ZVC7S4icMzRqqeZTOwkFvrF7y3gBMFry6Q/640?wx_fmt=png
https://mmbiz.qpic.cn/mmbiz_png/yjFUicxiaClgX68KMUXlCrcDZBLibB39ONUvibrL6nXup3CDqHVRlQOBozD8PLed4NBvT8oxpoejKgJ13STS9qGGuw/640?wx_fmt=png
https://mmbiz.qpic.cn/mmbiz_png/yjFUicxiaClgX68KMUXlCrcDZBLibB39ONU2qnN1Lo9DibibHeIElrZZFyY5xNzCH6fvSicDulkFN7L17FzVEjx32VMg/640?wx_fmt=png
从上图结果可知，<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(0, 82, 255);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">除Gender变量，其余变量均为数值型变量</strong></span>，那么待会再构建入模变量时，需要对<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(255, 104, 39);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">Gender变量创建哑变量</strong></span>；一般在做数据探索时，需要检查各变量是否存在<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(255, 104, 39);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">缺失的情况</strong></span>（如果缺失需要借助于删除法、替换法、插值法等完成缺失值的处理，具体可以参考文章【<a href="http://mp.weixin.qq.com/s?__biz=MzIxNjA2ODUzNg==&amp;mid=403255306&amp;idx=1&amp;sn=c5550bdabd2af3365bb992c8e6849b36&amp;scene=21#wechat_redirect" target="_blank" style="margin: 0px;padding: 0px;color: rgb(67, 149, 245);text-decoration: none;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">如何使用R语言解决可恶的脏数据</a>】），很显然上面的结果并没有显示数据中含有缺失值。
https://mmbiz.qpic.cn/mmbiz_png/yjFUicxiaClgX68KMUXlCrcDZBLibB39ONUTUIE9xjvOvE76pjibcHew88oRbkbJhnxGCE4kicSU7ItDjCs6tLPrJ6Q/640?wx_fmt=png
上面所做的处理无非是<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(0, 82, 255);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">构建哑变量</strong></span>，然后从哑变量中再剔除一个水平变量（这个非常重要，为了防止多重共线性）；同时还要<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(0, 82, 255);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">剔除没有意义的变量</strong></span>User ID和<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(0, 82, 255);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">不再使用的Gender变量</strong></span>（因为已经拆分为哑变量了）。OK，整理之后的数据集就如上图所示，接下来我们要基于这个数据集进行Logistic模型的创建。<br style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  />
https://mmbiz.qpic.cn/mmbiz_png/yjFUicxiaClgX68KMUXlCrcDZBLibB39ONUiaqKqTgH00haozfbZlHMVz7qtzRz5XyufoHbylDlE5mQNsSyUXg4lDA/640?wx_fmt=png
经过7次迭代后，模型系数的计算实现收敛，完成了Logistic分类器的创建。从上图的结果看，<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(255, 104, 39);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">除Male这个哑变量不显著</strong></span>（说明性别这个变量并不能构成用户是否购买的因素）外，其余的偏回归系数均为显著。下面，我们<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(0, 82, 255);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">不妨将Male变量剔除</strong></span>，再做一次Logistic模型。
https://mmbiz.qpic.cn/mmbiz_png/yjFUicxiaClgX68KMUXlCrcDZBLibB39ONUAZOcZ8VjGlONwOVgBa27Wx4SBibfQ38MSWxD1BEyc2ZKFe3zyvYRIxA/640?wx_fmt=png
https://mmbiz.qpic.cn/mmbiz_png/yjFUicxiaClgX68KMUXlCrcDZBLibB39ONUUIu7ZAXb3iavIuian1XtsQ6rxypWecTuxOTyn8cLGmxiatJ5sDePsRcTA/640?wx_fmt=png
很明显，通过变量的剔除，在<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(0, 82, 255);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">保证了所有变量显著的情况下，也降低了模型的AIC</strong></span>，说明，Male哑变量的删除是合理的。
https://mmbiz.qpic.cn/mmbiz_png/yjFUicxiaClgX68KMUXlCrcDZBLibB39ONUHKKAcQhZjsV2K4Y4nahVA4ek4F5B604uFHiaEQopb2KjuX7GdMhNlWA/640?wx_fmt=png
接下来，再来看看<span style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;color: rgb(255, 104, 39);"><strong style="margin: 0px;padding: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">模型的系数解释（优势比）</strong></span>，在其他变量不变的情况下，用户年龄每增加一个单位（岁），用户购买的概率是不够买概率的1.25倍；用户的年收入每增加一个单位（元），用户购买的概率与不够买概率几乎相等（因为这里只是计算年收入增加1元的概率比，如果对收入变量压缩10000倍，那这个概率比肯定就会上升了，因为此时收入上升一个单位就是一万元了）。
https://mmbiz.qpic.cn/mmbiz_png/yjFUicxiaClgX68KMUXlCrcDZBLibB39ONUAhFXdVg2Zl2nYb0PIYdwdm2fTB4DdDIXJibE4eenFh3ZszjCy14D5tA/640?wx_fmt=png
